var pos = [[
    {x: 850, y: 50, stn: "안심", dir: "right"},
    {x: 850, y: 150, stn: "각산", dir: "right"},
    {x: 850, y: 250, stn: "반야월", dir: "right"},
    {x: 850, y: 350, stn: "신기", dir: "right"},
    {x: 850, y: 450, stn: "율하", dir: "right"},
    {x: 850, y: 550, stn: "용계", dir: "right"},
    {x: 850, y: 650, stn: "방촌", dir: "right"},
    {x: 850, y: 750, stn: "해안", dir: "right"},
    {x: 850, y: 850, stn: "동촌", dir: "right"},
    {x: 850, y: 950, stn: "아양교", dir: "right"},
    {x: 850, y: 1050, stn: "동구청", dir: "right"},
    {x: 850, y: 1150, stn: "동대구역", dir: "right"},
    {x: 850, y: 1250, stn: "신천", dir: "right"},
    {x: 850, y: 1350, stn: "칠성시장", dir: "right"},
    {x: 850, y: 1450, stn: "대구역", dir: "right"},
    {x: 850, y: 1550, stn: "중앙로", dir: "right"},
    {x: 650, y: 1750, stn: "반월당", dir: "left"},
    {x: 450, y: 1950, stn: "명덕", dir: "left", rot: {up: "right", down:"left"}},
    {x: 250, y: 1950, stn: "교대", dir: "center", rot: {up: "right", down:"left"}},
    {x: 50, y: 2050, stn: "영대병원", dir: "left"},
    {x: 50, y: 2150, stn: "현충로", dir: "left"},
    {x: 50, y: 2250, stn: "안지랑", dir: "left"},
    {x: 50, y: 2350, stn: "대명", dir: "left"},
    {x: 50, y: 2450, stn: "서부정류장", dir: "left"},
    {x: 50, y: 2550, stn: "송현", dir: "left"},
    {x: 50, y: 2650, stn: "월촌", dir: "left"},
    {x: 50, y: 2750, stn: "상인", dir: "left"},
    {x: 50, y: 2850, stn: "월배", dir: "left"},
    {x: 50, y: 2950, stn: "진천", dir: "left"},
    {x: 50, y: 3050, stn: "대곡", dir: "left"},
    {x: 50, y: 3150, stn: "화원", dir: "left"},
    {x: 50, y: 3250, stn: "설화명곡", dir: "left"}
], [
    {x: 50, y: 550, stn: "문양", dir: "left"},
    {x: 50, y: 650, stn: "다사", dir: "left"},
    {x: 50, y: 750, stn: "대실", dir: "left"},
    {x: 50, y: 850, stn: "강창", dir: "left"},
    {x: 50, y: 950, stn: "계명대", dir: "left"},
    {x: 50, y: 1050, stn: "성서산업단지", dir: "left"},
    {x: 50, y: 1150, stn: "이곡", dir: "left"},
    {x: 50, y: 1250, stn: "용산", dir: "left"},
    {x: 50, y: 1350, stn: "죽전", dir: "left"},
    {x: 50, y: 1450, stn: "감삼", dir: "left"},
    {x: 50, y: 1550, stn: "두류", dir: "left"},
    {x: 50, y: 1650, stn: "내당", dir: "left"},
    {x: 250, y: 1750, stn: "반고개", dir: "center", rot: {up: "left", down:"right"}},
    {x: 450, y: 1750, stn: "청라언덕", dir: "left", rot: {up: "left", down:"right"}},
    {x: 650, y: 1750, stn: "반월당", dir: "left", rot: {up: "left", down:"right"}},
    {x: 850, y: 1850, stn: "경대병원", dir: "right"},
    {x: 850, y: 1950, stn: "대구은행", dir: "right"},
    {x: 850, y: 2050, stn: "범어", dir: "right"},
    {x: 850, y: 2150, stn: "수성구청", dir: "right"},
    {x: 850, y: 2250, stn: "만촌", dir: "right"},
    {x: 850, y: 2350, stn: "담티", dir: "right"},
    {x: 850, y: 2450, stn: "연호", dir: "right"},
    {x: 850, y: 2550, stn: "대공원", dir: "right"},
    {x: 850, y: 2650, stn: "고산", dir: "right"},
    {x: 850, y: 2750, stn: "신매", dir: "right"},
    {x: 850, y: 2850, stn: "사월", dir: "right"},
    {x: 850, y: 2950, stn: "정평", dir: "right"},
    {x: 850, y: 3050, stn: "임당", dir: "right"},
    {x: 850, y: 3150, stn: "영남대", dir: "right"}
], [
    {x: 450, y: 50, stn: "칠곡경대병원", dir: "left"},
    {x: 450, y: 150, stn: "학정", dir: "left"},
    {x: 450, y: 250, stn: "팔거", dir: "left"},
    {x: 450, y: 350, stn: "동천", dir: "left"},
    {x: 450, y: 450, stn: "칠곡운암", dir: "left"},
    {x: 450, y: 550, stn: "구암", dir: "left"},
    {x: 450, y: 650, stn: "태전", dir: "left"},
    {x: 450, y: 750, stn: "매천", dir: "left"},
    {x: 450, y: 850, stn: "매천시장", dir: "left"},
    {x: 450, y: 950, stn: "팔달", dir: "left"},
    {x: 450, y: 1050, stn: "공단", dir: "left"},
    {x: 450, y: 1150, stn: "만평", dir: "left"},
    {x: 450, y: 1250, stn: "팔달시장", dir: "left"},
    {x: 450, y: 1350, stn: "원대", dir: "left"},
    {x: 450, y: 1450, stn: "북구청", dir: "left"},
    {x: 450, y: 1550, stn: "달성공원", dir: "left"},
    {x: 450, y: 1650, stn: "서문시장", dir: "left"},
    {x: 450, y: 1750, stn: "청라언덕", dir: "left"},
    {x: 450, y: 1850, stn: "남산", dir: "left"},
    {x: 450, y: 1950, stn: "명덕", dir: "left"},
    {x: 450, y: 2050, stn: "건들바위", dir: "left"},
    {x: 450, y: 2150, stn: "대봉교", dir: "left"},
    {x: 450, y: 2250, stn: "수성시장", dir: "left"},
    {x: 450, y: 2350, stn: "수성구민운동장", dir: "left"},
    {x: 450, y: 2450, stn: "어린이회관", dir: "left"},
    {x: 450, y: 2550, stn: "황금", dir: "left"},
    {x: 450, y: 2650, stn: "수성못", dir: "left"},
    {x: 450, y: 2750, stn: "지산", dir: "left"},
    {x: 450, y: 2850, stn: "범물", dir: "left"},
    {x: 450, y: 2950, stn: "용지", dir: "left"}
]];
var trn = ["반월당", "청라언덕", "명덕"];

var map = document.getElementById("map");
var src = '';
for (var n = 0; n < 3; n++) {
    pos[n].forEach((e) => {
        src += '<circle cx="' + e.x + '" cy="' + e.y + '" r="11" onClick="onIconClicked(\'' + e.stn + '\');" />';
        if (trn.includes(e.stn)) return;
        var x = e.x,
            y = e.y;
        if (e.dir == 'left') x += 30;
        if (e.dir == 'right') x -= 30;
        if (e.dir == 'center') y += 50;
        src += '<text x=' + x + ' y=' + y + ' onClick="onTextClicked(this);" class=' + e.dir + '>' + e.stn + '</text>';
    });
}
var m = [16, 13, 19];
for (var n = 0; n < trn.length; n++) {
    src += '<text x=' + (pos[n][m[n]].x + 20) + ' y=' + (pos[n][m[n]].y + 40) + ' onClick="onTextClicked(this);" class="left trn">' + pos[n][m[n]].stn + '</text>';
}
map.innerHTML += src;
var mapData = map.innerHTML;


function updateData(data) {
    data = JSON.parse(data);
    data[0].forEach((e, i) => {
        var tmp = e.up;
        data[0][i].up = e.dn;
        data[0][i].dn = tmp;
    });
    data[0].reverse();

    var map = document.getElementById("map");
    var src = '';
    data.forEach((e, i) => {
        e.forEach((e, j) => {
            var p = pos[i][j],
                size = 20;
            var x = p.x,
                y = p.y;
            y -= 20;
            if (p.rot) {
                size = 40;
            }

            if (e.up) {
                x += 10;
                var dir = 'up';
                if (p.rot) {
                    dir = p.rot[dir];
                    x -= 30;
                    if (dir == 'left') y -= 10;
                    if (dir == 'right') y += 30;
                }
                src += '<image xlink:href="images/' + dir + '.png" x="' + x + '" y="' + y + '" width="' + size + 'px" opacity="0.7" />';
            }

            x = pos[i][j].x;
            y = p.y - 20;
            if (e.dn) {
                x -= 30;
                var dir = 'down';
                if (p.rot) {
                    dir = p.rot[dir];
                    x += 10;
                    if (dir == 'left') y -= 10;
                    if (dir == 'right') y += 30;
                }
                src += '<image xlink:href="images/' + dir + '.png" x="' + x + '" y="' + y + '" width="' + size + 'px" opacity="0.7" />';
            }
        });
    });
    map.innerHTML = mapData + src;
}

